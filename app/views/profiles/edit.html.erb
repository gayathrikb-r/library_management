<div class="card">
  <h1>Edit Profile Details</h1>
  
 <%= form_with model: @profile, url: profile_path, method: :patch do |f| %>
    <% if @profile.errors.any? %>
      <div class="flash alert">
        <h3><%= pluralize(@profile.errors.count, "error") %>:</h3>
        <ul>
          <% @profile.errors.full_messages.each do |message| %>
            <li><%= message %></li>
          <% end %>
        </ul>
      </div>
    <% end %>
    
    <div class="form-group">
      <%= f.label :bio, "About Me" %>
      <%= f.text_area :bio, rows: 4, placeholder: "Tell us about yourself..." %>
    </div>
    
    <div class="form-group">
      <%= f.label :birth_date %>
      <%= f.date_field :birth_date %>
    </div>
    
    <div class="form-group">
      <%= f.label :liked_genres, "Favorite Genres (Select up to 5)" %>
      
      <div class="genre-selector">
        <% Category.order(:name).each do |category| %>
          <label class="genre-checkbox">
            <%= check_box_tag 'profile[liked_genres][]', 
                category.name, 
                @profile.liked_genres.include?(category.name),
                id: "profile_liked_genres_#{category.id}",
                class: "genre-check",
                data: { max: 5 } %>
            <span class="genre-label"><%= category.name %></span>
          </label>
        <% end %>
      </div>
      
      <small style="color: #666; display: block; margin-top: 10px;">
        Selected: <strong><span id="genre-count">0</span>/5</strong>
      </small>
    </div>
    
    <div class="form-group">
      <%= f.label :favorite_author_id, "Favorite Author" %>
      <%= f.collection_select :favorite_author_id, 
          Author.all.order(:name), 
          :id, 
          :name, 
          { include_blank: "Select an author" },
          { class: "form-control" }
      %>
    </div>
    
    <%= f.submit "Update Profile", class: "btn" %>
<%= link_to "Back to Profile", profile_path, class: "btn btn-secondary" %>
  <% end %>
</div>

<style>
  .genre-selector {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 10px;
    padding: 15px;
    background: #f9f9f9;
    border: 1px solid #ddd;
    border-radius: 4px;
    max-height: 300px;
    overflow-y: auto;
  }
  
  .genre-checkbox {
    display: flex;
    align-items: center;
    padding: 8px 12px;
    background: white;
    border: 2px solid #ddd;
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.2s;
    margin: 0;
  }
  
  .genre-checkbox:hover {
    border-color: #007bff;
    background: #f0f8ff;
  }
  
  .genre-checkbox input[type="checkbox"] {
    margin-right: 8px;
    cursor: pointer;
    width: 18px;
    height: 18px;
  }
  
  .genre-checkbox input[type="checkbox"]:checked + .genre-label {
    font-weight: bold;
    color: #007bff;
  }
  
  .genre-checkbox:has(input:checked) {
    background: #e7f3ff;
    border-color: #007bff;
  }
  
  .genre-label {
    flex: 1;
    cursor: pointer;
  }
  
  .form-control {
    width: 100%;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 4px;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const checkboxes = document.querySelectorAll('.genre-check');
    const countDisplay = document.getElementById('genre-count');
    const maxSelection = 5;
    
    function updateCount() {
      const checkedCount = document.querySelectorAll('.genre-check:checked').length;
      countDisplay.textContent = checkedCount;
      
      // Disable unchecked boxes if limit reached
      if (checkedCount >= maxSelection) {
        checkboxes.forEach(cb => {
          if (!cb.checked) {
            cb.disabled = true;
            cb.parentElement.style.opacity = '0.5';
            cb.parentElement.style.cursor = 'not-allowed';
          }
        });
      } else {
        checkboxes.forEach(cb => {
          cb.disabled = false;
          cb.parentElement.style.opacity = '1';
          cb.parentElement.style.cursor = 'pointer';
        });
      }
    }
    
    checkboxes.forEach(cb => {
      cb.addEventListener('change', updateCount);
    });
    
    // Initial count
    updateCount();
  });
</script>



