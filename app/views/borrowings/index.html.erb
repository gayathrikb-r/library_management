<h1>ðŸ“– Borrowings</h1>

<% if librarian? %>
  <div class="card">
    <div style="display: flex; gap: 10px;">
      <%= link_to "All", borrowings_path, class: "btn #{params[:filter].nil? ? 'btn-success' : ''}" %>
      <%= link_to "Active", borrowings_path(filter: 'active'), class: "btn #{params[:filter] == 'active' ? 'btn-success' : ''}" %>
      <%= link_to "Overdue", borrowings_path(filter: 'overdue'), class: "btn #{params[:filter] == 'overdue' ? 'btn-success' : ''}" %>
      <%= link_to "Returned", borrowings_path(filter: 'returned'), class: "btn #{params[:filter] == 'returned' ? 'btn-success' : ''}" %>
    </div>
  </div>
<% end %>

<div class="card">
  <% if @borrowings.any? %>
    <table>
      <thead>
        <tr>
          <% if librarian? %>
            <th>User</th>
          <% end %>
          <th>Book</th>
          <th>Borrowed Date</th>
          <th>Due Date</th>
          <th>Return Date</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <% @borrowings.each do |borrowing| %>
          <tr>
            <% if librarian? %>
              <td><%= link_to borrowing.user.name, borrowing.user %></td>
            <% end %>
            <td><%= link_to borrowing.book.title, borrowing.book %></td>
            <td><%= borrowing.borrowed_date.strftime("%b %d, %Y") %></td>
            <td><%= borrowing.due_date.strftime("%b %d, %Y") %></td>
            <td><%= borrowing.returned_date&.strftime("%b %d, %Y") || "Not returned" %></td>
            <td>
              <% if borrowing.status == 'returned' %>
                <span class="badge badge-success">Returned</span>
              <% elsif borrowing.status == 'overdue' %>
                <span class="badge badge-danger">Overdue (<%= borrowing.days_overdue %> days)</span>
              <% else %>
                <span class="badge badge-info">Active</span>
              <% end %>
            </td>
            <td>
              <% if borrowing.status != 'returned' %>
                <%= link_to "Return", return_book_borrowing_path(borrowing), 
                    data: { turbo_method: :patch }, class: "btn btn-success" %>
              <% end %>
              <%= link_to "Details", borrowing, class: "btn btn-secondary" %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  <% else %>
    <p>No borrowings found.</p>
  <% end %>
</div>